From 6bacfdcb84a4b80c7c026e926b7e1f84d6eed26d Mon Sep 17 00:00:00 2001
From: shixuantong <1726671442@qq.com>
Date: Wed, 6 Apr 2022 17:40:57 +0800
Subject: [PATCH] Ensure that sz is greater than 0.

---
 lib/block.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/lib/block.c b/lib/block.c
index 092bc28..80b41ac 100644
--- a/lib/block.c
+++ b/lib/block.c
@@ -129,6 +129,11 @@ th_read(TAR *t)
 	if (TH_ISLONGLINK(t))
 	{
 		sz = th_get_size(t);
+		if ((int)sz <= 0)
+		{
+			errno = EINVAL;
+			return -1;
+		}
 		blocks = (sz / T_BLOCKSIZE) + (sz % T_BLOCKSIZE ? 1 : 0);
 		if (blocks > ((size_t)-1 / T_BLOCKSIZE))
 		{
@@ -179,6 +1184,11 @@ th_read(TAR *t)
 	if (TH_ISLONGNAME(t))
 	{
 		sz = th_get_size(t);
+		if ((int)sz <= 0)
+		{
+			errno = EINVAL;
+			return -1;
+		}
 		blocks = (sz / T_BLOCKSIZE) + (sz % T_BLOCKSIZE ? 1 : 0);
 		if (blocks > ((size_t)-1 / T_BLOCKSIZE))
 		{
--
1.8.3.1
